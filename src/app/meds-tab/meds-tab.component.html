<h2>Plan leków</h2>

<canvas #medsChart *ngIf="(sorted?.length ?? 0) > 0"></canvas>

<table *ngIf="(sorted?.length ?? 0) > 0; else noMeds">
  <thead>
    <tr>
      <th>Nazwa</th>
      <th>Dawka</th>
      <th>Częstotliwość</th>
      <th>Godziny</th>
      <th>Start</th>
      <th>Koniec</th>
      <th>Aktywna</th>
      <th>Akcje</th>
      <th>Uwagi</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let m of sorted; trackBy: trackByIndex">
      <td data-label="Nazwa">{{ m.name }}</td>
      <td data-label="Dawka">{{ m.dose }}</td>
      <td data-label="Częstotliwość">{{ m.frequency || '—' }}</td>
      <td data-label="Godziny">{{ (m.timesOfDay || []).join(', ') || '—' }}</td>
      <td data-label="Start">{{ m.startDate }}</td>
      <td data-label="Koniec">{{ m.endDate || '—' }}</td>

      <td data-label="Aktywna">
        <span class="pill" [ngClass]="m.isActive ? 'active' : 'inactive'">
          {{ m.isActive ? 'Tak' : 'Nie' }}
        </span>
      </td>

      <td data-label="Akcje" class="actions">
        <button
          type="button"
          class="pill toggle"
          [disabled]="!animalId || !m._id || saving.has(m._id!)"
          (click)="onToggleActive(m)">
          {{ m.isActive ? 'Wyłącz' : 'Włącz' }}
        </button>

        <button
          type="button"
          class="pill danger"
          [disabled]="!animalId || !m._id || saving.has(m._id!)"
          (click)="onDelete(m)"
          aria-label="Usuń lek">
          Usuń
        </button>
      </td>

      <td data-label="Uwagi">{{ m.notes || '—' }}</td>
    </tr>
  </tbody>
</table>

<ng-template #noMeds>
  <p class="no-data">Brak leków.</p>
</ng-template>
