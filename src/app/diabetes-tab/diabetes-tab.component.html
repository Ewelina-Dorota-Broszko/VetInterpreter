<h2>Zapisy cukrzycy</h2>

<!-- Wykres glukozy -->
<div class="chart-container" *ngIf="sorted?.length">
  <canvas #diabetesChart></canvas>
</div>

<!-- Tabela z pomiarami -->
<table *ngIf="sorted?.length; else noDiab" class="diabetes-table">
  <thead>
    <tr>
      <th>Data</th>
      <th>Godzina</th>
      <th>Glukoza (mg/dL)</th>
      <th>Rodzaj pomiaru</th>
      <th>Insulina</th>
      <th>Dawka (j.)</th>
      <th>Uwagi</th>
    </tr>
  </thead>

  <tbody>
    <tr *ngFor="let d of sorted; trackBy: trackByIndex">
      <td data-label="Data">{{ d.date }}</td>
      <td data-label="Godzina">{{ d.time }}</td>

      <!-- Kolorowanie poziomu glukozy -->
      <td
        data-label="Glukoza (mg/dL)"
        [ngClass]="{
          'low': d.glucose < 70,
          'normal': d.glucose >= 70 && d.glucose <= 140,
          'high': d.glucose > 140
        }"
      >
        {{ d.glucose }}
      </td>

      <!-- Typ pomiaru -->
      <td data-label="Rodzaj pomiaru">
        <ng-container [ngSwitch]="d.measurementType">
          <span *ngSwitchCase="'fasting'">Na czczo</span>
          <span *ngSwitchCase="'postMeal'">Po posiłku</span>
          <span *ngSwitchCase="'random'">Przypadkowy</span>
          <span *ngSwitchDefault>-</span>
        </ng-container>
      </td>

      <!-- Insulina -->
      <td data-label="Insulina">{{ d.insulinType || '—' }}</td>
      <td data-label="Dawka">{{ d.insulinDose != null ? d.insulinDose : '—' }}</td>
      <td data-label="Uwagi">{{ d.comments || '—' }}</td>
    </tr>
  </tbody>
</table>

<ng-template #noDiab>
  <p>Brak zapisów cukrzycy.</p>
</ng-template>
