<div class="blood-wrapper" *ngIf="bloodTests?.length; else noBlood">
  <h2>Badania krwi</h2>

  <!-- === WYKRES TRENDU / HISTOGRAM === -->
  <div class="chart-container" *ngIf="bloodTests?.length">
    <canvas #bloodChartCanvas></canvas>
  </div>

  <!-- === KARTY Z DANYMI === -->
  <div class="blood-grid">
    <div class="blood-card" *ngFor="let test of bloodTests">
      <div class="header">
        <h3>{{ test.date }}</h3>
      </div>

      <div class="section">
    <h4>Morfologia</h4>
    <div class="row">
      <div class="cell" [ngClass]="getValueStatus(test.hemoglobin!, 'hemoglobin')" *ngFor="let test of bloodTests">
        <span class="label">HGB</span>
        <span class="value">{{ test.hemoglobin }}</span>
        <small>{{ getRangeText('hemoglobin') }}</small>
      </div>

      <div class="cell" [ngClass]="getValueStatus(test.rbc!, 'rbc')" *ngFor="let test of bloodTests">
        <span class="label">RBC</span>
        <span class="value">{{ test.rbc }}</span>
        <small>{{ getRangeText('rbc') }}</small>
      </div>

      <div class="cell" [ngClass]="getValueStatus(test.wbc!, 'wbc')" *ngFor="let test of bloodTests">
        <span class="label">WBC</span>
        <span class="value">{{ test.wbc }}</span>
        <small>{{ getRangeText('wbc') }}</small>
      </div>

      <div class="cell" [ngClass]="getValueStatus(test.hematocrit!, 'hematocrit')" *ngFor="let test of bloodTests">
        <span class="label">Hematokryt</span>
        <span class="value">{{ test.hematocrit }}</span>
        <small>{{ getRangeText('hematocrit') }}</small>
      </div>

      <div class="cell" [ngClass]="getValueStatus(test.platelets!, 'platelets')" *ngFor="let test of bloodTests">
        <span class="label">Płytki</span>
        <span class="value">{{ test.platelets }}</span>
        <small>{{ getRangeText('platelets') }}</small>
      </div>

      <div class="cell" [ngClass]="getValueStatus(test.mcv!, 'mcv')" *ngFor="let test of bloodTests">
        <span class="label">MCV</span>
        <span class="value">{{ test.mcv }}</span>
        <small>{{ getRangeText('mcv') }}</small>
      </div>

      <div class="cell" [ngClass]="getValueStatus(test.mch!, 'mch')" *ngFor="let test of bloodTests">
        <span class="label">MCH</span>
        <span class="value">{{ test.mch }}</span>
        <small>{{ getRangeText('mch') }}</small>
      </div>

      <div class="cell" [ngClass]="getValueStatus(test.mchc!, 'mchc')" *ngFor="let test of bloodTests">
        <span class="label">MCHC</span>
        <span class="value">{{ test.mchc }}</span>
        <small>{{ getRangeText('mchc') }}</small>
      </div>
    </div>
  </div>
       <div class="section">
    <h4>Biochemia</h4>
    <div class="row">
      <div class="cell" [ngClass]="getValueStatus(test.glucose!, 'glucose')" *ngFor="let test of bloodTests">
        <span class="label">Glukoza</span>
        <span class="value">{{ test.glucose }}</span>
        <small>{{ getRangeText('glucose') }}</small>
      </div>

      <div class="cell" [ngClass]="getValueStatus(test.urea!, 'urea')" *ngFor="let test of bloodTests">
        <span class="label">Mocznik</span>
        <span class="value">{{ test.urea }}</span>
        <small>{{ getRangeText('urea') }}</small>
      </div>

      <div class="cell" [ngClass]="getValueStatus(test.creatinine!, 'creatinine')" *ngFor="let test of bloodTests">
        <span class="label">Kreatynina</span>
        <span class="value">{{ test.creatinine }}</span>
        <small>{{ getRangeText('creatinine') }}</small>
      </div>

      <div class="cell" [ngClass]="getValueStatus(test.alt!, 'alt')" *ngFor="let test of bloodTests">
        <span class="label">ALT (GPT)</span>
        <span class="value">{{ test.alt }}</span>
        <small>{{ getRangeText('alt') }}</small>
      </div>

      <div class="cell" [ngClass]="getValueStatus(test.ast!, 'ast')" *ngFor="let test of bloodTests">
        <span class="label">AST (GOT)</span>
        <span class="value">{{ test.ast }}</span>
        <small>{{ getRangeText('ast') }}</small>
      </div>

      <div class="cell" [ngClass]="getValueStatus(test.alp!, 'alp')" *ngFor="let test of bloodTests">
        <span class="label">ALP</span>
        <span class="value">{{ test.alp }}</span>
        <small>{{ getRangeText('alp') }}</small>
      </div>
    </div>
  </div>
      <div class="section">
    <h4>Białka i Bilirubiny</h4>
    <div class="row">
      <div class="cell" [ngClass]="getValueStatus(test.totalProtein!, 'totalProtein')" *ngFor="let test of bloodTests">
        <span class="label">Białko całkowite</span>
        <span class="value">{{ test.totalProtein }}</span>
        <small>{{ getRangeText('totalProtein') }}</small>
      </div>

      <div class="cell" [ngClass]="getValueStatus(test.albumin!, 'albumin')" *ngFor="let test of bloodTests">
        <span class="label">Albuminy</span>
        <span class="value">{{ test.albumin }}</span>
        <small>{{ getRangeText('albumin') }}</small>
      </div>

      <div class="cell" [ngClass]="getValueStatus(test.globulin!, 'globulin')" *ngFor="let test of bloodTests">
        <span class="label">Globuliny</span>
        <span class="value">{{ test.globulin }}</span>
        <small>{{ getRangeText('globulin') }}</small>
      </div>

      <div class="cell" [ngClass]="getValueStatus(test.bilirubinTotal!, 'bilirubinTotal')" *ngFor="let test of bloodTests">
        <span class="label">Bilirubina całkowita</span>
        <span class="value">{{ test.bilirubinTotal }}</span>
        <small>{{ getRangeText('bilirubinTotal') }}</small>
      </div>

      <div class="cell" [ngClass]="getValueStatus(test.bilirubinDirect!, 'bilirubinDirect')" *ngFor="let test of bloodTests">
        <span class="label">Bilirubina bezpośrednia</span>
        <span class="value">{{ test.bilirubinDirect }}</span>
        <small>{{ getRangeText('bilirubinDirect') }}</small>
      </div>

      <div class="cell" [ngClass]="getValueStatus(test.bilirubinIndirect!, 'bilirubinIndirect')" *ngFor="let test of bloodTests">
        <span class="label">Bilirubina pośrednia</span>
        <span class="value">{{ test.bilirubinIndirect }}</span>
        <small>{{ getRangeText('bilirubinIndirect') }}</small>
      </div>
    </div>
  </div>

      <div class="section">
        <h4>Inne</h4>
        <div class="row">
          <div class="cell">
            <span class="label">Komentarz</span>
            <span class="value">{{ test.comments || '—' }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #noBlood>
  <p class="no-data">Brak badań krwi.</p>
</ng-template>
