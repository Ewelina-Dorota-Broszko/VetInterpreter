<div class="blood-wrapper" *ngIf="bloodTests?.length; else noBlood">
  <h2>Badania krwi</h2>

  <!-- WYKRES -->
  <div class="chart-container" *ngIf="bloodTests?.length">
    <canvas #bloodChartCanvas></canvas>
  </div>

  <div *ngFor="let test of bloodTests" class="blood-report">
    <h3>{{ test.date }}</h3>

    <!-- MORFOLOGIA -->
    <div class="blood-table">
      <h4>Morfodwlogia</h4>
      <table>
        <thead>
          <tr>
            <th>PARAMETR</th>
            <th>WARTOŚĆ</th>
            <th>J.M.</th>
            <th>MIN</th>
            <th>MAX</th>
            <th>Zakres</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let param of morphologyParams">
            <td>{{ param.label }}</td>
            <td [ngClass]="getValueStatus(getValue(test, param.key), param.key)">
              {{ getValue(test, param.key) ?? '—' }}
            </td>
            <td>{{ referenceRanges[param.key].unit }}</td>
            <td>{{ referenceRanges[param.key].min }}</td>
            <td>{{ referenceRanges[param.key].max }}</td>
            <td>
              <div class="bar-container">
                <div class="bar-bg">
                  <div class="bar-fill" [ngStyle]="getBarStyle(getValue(test, param.key), param.key)"></div>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- BIOCHEMIA -->
    <div class="blood-table">
      <h4>Biochemia</h4>
      <table>
        <thead>
          <tr>
            <th>PARAMETR</th>
            <th>WARTOŚĆ</th>
            <th>J.M.</th>
            <th>MIN</th>
            <th>MAX</th>
            <th>Zakres</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let param of biochemParams">
            <td>{{ param.label }}</td>
            <td [ngClass]="getValueStatus(getValue(test, param.key), param.key)">
              {{ getValue(test, param.key) ?? '—' }}
            </td>
            <td>{{ referenceRanges[param.key].unit }}</td>
            <td>{{ referenceRanges[param.key].min }}</td>
            <td>{{ referenceRanges[param.key].max }}</td>
            <td>
              <div class="bar-container">
                <div class="bar-bg">
                  <div class="bar-fill" [ngStyle]="getBarStyle(getValue(test, param.key), param.key)"></div>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- BIAŁKA I BILIRUBINY -->
    <div class="blood-table">
      <h4>Białka i Bilirubiny</h4>
      <table>
        <thead>
          <tr>
            <th>PARAMETR</th>
            <th>WARTOŚĆ</th>
            <th>J.M.</th>
            <th>MIN</th>
            <th>MAX</th>
            <th>Zakres</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let key of ['albumin','globulin','totalProtein','bilirubinTotal','bilirubinDirect','bilirubinIndirect']">
            <td>{{ key | titlecase }}</td>
            <td [ngClass]="getValueStatus(getValue(test, key), key)">
              {{ getValue(test, key) ?? '—' }}
            </td>
            <td>{{ referenceRanges[key].unit }}</td>
            <td>{{ referenceRanges[key].min }}</td>
            <td>{{ referenceRanges[key].max }}</td>
            <td>
              <div class="bar-container">
                <div class="bar-bg">
                  <div class="bar-fill" [ngStyle]="getBarStyle(getValue(test, key), key)"></div>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- KOMENTARZ -->
    <div class="blood-table">
      <h4>Komentarz</h4>
      <p class="comment">
        {{ test.comments || 'Brak uwag do badania.' }}
      </p>
    </div>
  </div>
</div>

<ng-template #noBlood>
  <p class="no-data">Brak badań krwi.</p>
</ng-template>
