<div class="dashboard-menu-container">
  <div class="container">

    <div *ngIf="loading" class="muted">Ładowanie…</div>
    <p class="error" *ngIf="!loading && error">{{ error }}</p>

    <div *ngIf="!loading && animal">
      <!-- Pasek akcji -->
      <div class="bar">
        <button class="ghost" routerLink="/vet/patients">← Wróć</button>
        <!-- <div class="right">
          <button (click)="addDoc('blood')">+ Krew</button>
          <button (click)="addDoc('urine')">+ Mocz</button>
          <button (click)="addDoc('temperature')">+ Temp</button>
          <button (click)="addDoc('weight')">+ Waga</button>
          <button (click)="addDoc('vaccination')">+ Szczep.</button>
          <button (click)="addDoc('meds')">+ Lek</button>
          <button (click)="addDoc('symptoms')">+ Objaw</button>
        </div> -->
      </div>

      <!-- ===== Nagłówek profilu ===== -->
      <div class="profile-wrapper">
        <header class="header">
          <div class="info">
            <h1>{{ animal.name }}</h1>
            <p *ngIf="animal.ownerName">Właściciel: <strong>{{ animal.ownerName }}</strong></p>
            <p>
              Gatunek: <strong>{{ animal.species }}</strong>
              <span *ngIf="animal.breed"> | Rasa: <strong>{{ animal.breed }}</strong></span>
            </p>
            <p>
              Płeć: <strong>{{ animal.sex || '—' }}</strong>
              <span *ngIf="animal.weightKg"> | Waga: <strong>{{ animal.weightKg }} kg</strong></span>
            </p>
            <p *ngIf="getAgeYears() !== null">Wiek: <strong>{{ getAgeYears() }} lat</strong></p>

            <p class="muted small">
              Widok veta — poniżej pokazuję wyłącznie wpisy dodane przez weterynarzy.
            </p>
          </div>

          <div class="actions">
            <button type="button" (click)="addDoc('blood')">Dodaj nowy dokument</button>
          </div>
        </header>

        <!-- ===== Zakładki ===== -->
        <nav class="tabs">
          <button [class.active]="activeTab === 'overview'" (click)="setTab('overview')">Podsumowanie</button>
          <button [class.active]="activeTab === 'blood'" (click)="setTab('blood')">Krew</button>
          <button [class.active]="activeTab === 'urine'" (click)="setTab('urine')">Mocz</button>
          <button [class.active]="activeTab === 'stool'" (click)="setTab('stool')">Kał</button>
          <button [class.active]="activeTab === 'temperature'" (click)="setTab('temperature')">Temperatura</button>
          <button [class.active]="activeTab === 'diabetes'" (click)="setTab('diabetes')">Cukrzyca</button>
          <button [class.active]="activeTab === 'weight'" (click)="setTab('weight')">Waga & BCS</button>
          <button [class.active]="activeTab === 'vaccinations'" (click)="setTab('vaccinations')">Szczepienia</button>
          <button [class.active]="activeTab === 'meds'" (click)="setTab('meds')">Leki</button>
          <button [class.active]="activeTab === 'symptoms'" (click)="setTab('symptoms')">Objawy</button>
        </nav>

        <!-- ===== Blood ===== -->
        <section *ngIf="activeTab === 'blood'" class="tab-content">
          <div *ngIf="loadingBlood" class="muted">Ładowanie badań krwi…</div>
          <ng-container *ngIf="!loadingBlood">
            <app-blood-tab
              *ngIf="bloodLoaded"
              [active]="true"
              [bloodTests]="bloodTestsVet"
              [referenceRanges]="referenceRanges">
            </app-blood-tab>
            <p class="error" *ngIf="bloodError">{{ bloodError }}</p>
            <p class="muted" *ngIf="bloodLoaded && !bloodTestsVet.length">Brak badań krwi dodanych przez veta.</p>
          </ng-container>
        </section>

        <!-- ===== Urine ===== -->
        <section *ngIf="activeTab === 'urine'" class="tab-content">
          <div *ngIf="loadingUrine" class="muted">Ładowanie badań moczu…</div>
          <ng-container *ngIf="!loadingUrine">
            <app-urine-tab *ngIf="urineLoaded" [urineTests]="urineTestsVet"></app-urine-tab>
            <p class="error" *ngIf="urineError">{{ urineError }}</p>
            <p class="muted" *ngIf="urineLoaded && !urineTestsVet.length">Brak badań moczu dodanych przez veta.</p>
          </ng-container>
        </section>

        <!-- ===== Stool ===== -->
        <section *ngIf="activeTab === 'stool'" class="tab-content">
          <div *ngIf="loadingStool" class="muted">Ładowanie badań kału…</div>
          <ng-container *ngIf="!loadingStool">
            <app-stool-tab *ngIf="stoolLoaded" [stoolTests]="stoolTestsVet"></app-stool-tab>
            <p class="error" *ngIf="stoolError">{{ stoolError }}</p>
            <p class="muted" *ngIf="stoolLoaded && !stoolTestsVet.length">Brak badań kału dodanych przez veta.</p>
          </ng-container>
        </section>

        <!-- ===== Temperature ===== -->
        <section *ngIf="activeTab === 'temperature'" class="tab-content">
          <div *ngIf="loadingTemperature" class="muted">Ładowanie pomiarów temperatury…</div>
          <ng-container *ngIf="!loadingTemperature">
            <app-temperature-tab *ngIf="temperatureLoaded" [temperatureLogs]="temperatureLogsVet"></app-temperature-tab>
            <p class="error" *ngIf="temperatureError">{{ temperatureError }}</p>
            <p class="muted" *ngIf="temperatureLoaded && !temperatureLogsVet.length">
              Brak pomiarów dodanych przez veta.
            </p>
          </ng-container>
        </section>

        <!-- ===== Diabetes ===== -->
        <section *ngIf="activeTab === 'diabetes'" class="tab-content">
          <div *ngIf="loadingDiabetes" class="muted">Ładowanie wpisów cukrzycy…</div>
          <ng-container *ngIf="!loadingDiabetes">
            <app-diabetes-tab *ngIf="diabetesLoaded" [diabetesLogs]="diabetesLogsVet"></app-diabetes-tab>
            <p class="error" *ngIf="diabetesError">{{ diabetesError }}</p>
            <p class="muted" *ngIf="diabetesLoaded && !diabetesLogsVet.length">
              Brak wpisów cukrzycowych dodanych przez veta.
            </p>
          </ng-container>
        </section>

        <!-- ===== Weight ===== -->
        <section *ngIf="activeTab === 'weight'" class="tab-content">
          <div *ngIf="loadingWeight" class="muted">Ładowanie historii wagi…</div>
          <ng-container *ngIf="!loadingWeight">
            <app-weight-tab *ngIf="weightLoaded" [weightHistory]="weightHistoryVet"></app-weight-tab>
            <p class="error" *ngIf="weightError">{{ weightError }}</p>
            <p class="muted" *ngIf="weightLoaded && !weightHistoryVet.length">
              Brak historii wagi dodanej przez veta.
            </p>
          </ng-container>
        </section>

        <!-- ===== Vaccinations ===== -->
        <section *ngIf="activeTab === 'vaccinations'" class="tab-content">
          <div *ngIf="loadingVacc" class="muted">Ładowanie szczepień…</div>
          <ng-container *ngIf="!loadingVacc">
            <app-vaccinations-tab *ngIf="vaccLoaded" [vaccinations]="vaccinationsVet"></app-vaccinations-tab>
            <p class="error" *ngIf="vaccError">{{ vaccError }}</p>
            <p class="muted" *ngIf="vaccLoaded && !vaccinationsVet.length">
              Brak szczepień dodanych przez veta.
            </p>
          </ng-container>
        </section>

        <!-- ===== Medications ===== -->
        <section *ngIf="activeTab === 'meds'" class="tab-content">
          <div *ngIf="loadingMeds" class="muted">Ładowanie leków…</div>
          <ng-container *ngIf="!loadingMeds">
            <app-meds-tab *ngIf="medsLoaded" [animalId]="animal?._id" [medications]="medicationsVet"></app-meds-tab>
            <p class="error" *ngIf="medsError">{{ medsError }}</p>
            <p class="muted" *ngIf="medsLoaded && !medicationsVet.length">Brak leków dodanych przez veta.</p>
          </ng-container>
        </section>

        <!-- ===== Symptoms ===== -->
        <section *ngIf="activeTab === 'symptoms'" class="tab-content">
          <div *ngIf="loadingSymptoms" class="muted">Ładowanie objawów…</div>
          <ng-container *ngIf="!loadingSymptoms">
            <app-symptoms-tab *ngIf="symptomsLoaded" [symptoms]="symptomsVet"></app-symptoms-tab>
            <p class="error" *ngIf="symptomsError">{{ symptomsError }}</p>
            <p class="muted" *ngIf="symptomsLoaded && !symptomsVet.length">Brak objawów dodanych przez veta.</p>
          </ng-container>
        </section>
      </div>
    </div>

    <div *ngIf="!loading && !animal" class="empty-state">
      Nie znaleziono zwierzaka.
    </div>

  </div>
</div>
