<div class="dashboard-menu-container">
  <div class="container">

    <div *ngIf="loading" class="muted">Ładowanie…</div>
    <p class="error" *ngIf="!loading && error">{{ error }}</p>

    <div *ngIf="!loading && animal">
      <!-- Pasek akcji -->
      <div class="bar">
        <button class="ghost" routerLink="/vet/patients">← Wróć</button>
        <!-- <div class="right">
          <button (click)="addDoc('blood')">+ Krew</button>
          <button (click)="addDoc('urine')">+ Mocz</button>
          <button (click)="addDoc('temperature')">+ Temp</button>
          <button (click)="addDoc('weight')">+ Waga</button>
          <button (click)="addDoc('vaccination')">+ Szczep.</button>
          <button (click)="addDoc('meds')">+ Lek</button>
          <button (click)="addDoc('symptoms')">+ Objaw</button>
        </div> -->
      </div>

      <!-- ===== Nagłówek profilu ===== -->
      <div class="profile-wrapper">
        <header class="header">
          <div class="info">
            <h1>{{ animal.name }}</h1>
            <p *ngIf="animal.ownerName">Właściciel: <strong>{{ animal.ownerName }}</strong></p>
            <p>
              Gatunek: <strong>{{ animal.species }}</strong>
              <span *ngIf="animal.breed"> | Rasa: <strong>{{ animal.breed }}</strong></span>
            </p>
            <p>
              Płeć: <strong>{{ animal.sex || '—' }}</strong>
              <span *ngIf="animal.weightKg"> | Waga: <strong>{{ animal.weightKg }} kg</strong></span>
            </p>
            <p *ngIf="getAgeYears() !== null">Wiek: <strong>{{ getAgeYears() }} lat</strong></p>

            <p class="muted small">
              Widok veta — filtr: <strong>{{ scopeLabel[scope] }}</strong>
            </p>

            <!-- Filtr scope -->
            <div class="scope-filter" style="margin: 8px 0 0;">
              <label>
                Pokaż wpisy:
                <select [(ngModel)]="scope" (change)="onScopeChange()">
                  <option value="mine">Moje</option>
                  <option value="vet">Wszyscy weterynarze</option>
                  <option value="owner">Właściciel</option>
                  <option value="all">Wszystkie</option>
                </select>
              </label>
            </div>
          </div>

          <div class="actions">
            <button type="button" (click)="addDoc('blood')">Dodaj nowy dokument</button>
          </div>
        </header>

        <!-- ===== Zakładki ===== -->
        <nav class="tabs">
          <!-- <button [class.active]="activeTab === 'overview'" (click)="setTab('overview')">Podsumowanie</button> -->
          <button [class.active]="activeTab === 'blood'" (click)="setTab('blood')">Krew</button>
          <button [class.active]="activeTab === 'urine'" (click)="setTab('urine')">Mocz</button>
          <button [class.active]="activeTab === 'stool'" (click)="setTab('stool')">Kał</button>
          <button [class.active]="activeTab === 'temperature'" (click)="setTab('temperature')">Temperatura</button>
          <button [class.active]="activeTab === 'diabetes'" (click)="setTab('diabetes')">Cukrzyca</button>
          <button [class.active]="activeTab === 'weight'" (click)="setTab('weight')">Waga & BCS</button>
          <button [class.active]="activeTab === 'vaccinations'" (click)="setTab('vaccinations')">Szczepienia</button>
          <button [class.active]="activeTab === 'meds'" (click)="setTab('meds')">Leki</button>
          <button [class.active]="activeTab === 'symptoms'" (click)="setTab('symptoms')">Objawy</button>
        </nav>

        <!-- ===== Badania krwi ===== -->
        <section *ngIf="activeTab === 'blood'" class="tab-content">
          <ng-container *ngIf="(bloodTestsVet?.length ?? 0) > 0; else bloodEmpty">
            <app-blood-tab [bloodTests]="bloodTestsVet" [referenceRanges]="referenceRanges"
              [active]="activeTab === 'blood'">
            </app-blood-tab>
          </ng-container>

          <ng-template #bloodEmpty>
            <p class="muted">Brak danych w wybranym filtrze.</p>
          </ng-template>
        </section>

        <!-- ===== Badania moczu ===== -->
        <section *ngIf="activeTab === 'urine'" class="tab-content">
          <ng-container *ngIf="(urineTestsVet?.length ?? 0) > 0; else urineEmpty">
            <app-urine-tab [urineTests]="urineTestsVet"></app-urine-tab>
          </ng-container>
          <ng-template #urineEmpty>
            <p class="muted">Brak danych w wybranym filtrze.</p>
          </ng-template>
        </section>

        <!-- ===== Badania kału ===== -->
        <section *ngIf="activeTab === 'stool'" class="tab-content">
          <ng-container *ngIf="(stoolTestsVet?.length ?? 0) > 0; else stoolEmpty">
            <app-stool-tab [stoolTests]="stoolTestsVet"></app-stool-tab>
          </ng-container>
          <ng-template #stoolEmpty>
            <p class="muted">Brak danych w wybranym filtrze.</p>
          </ng-template>
        </section>

        <!-- ===== Temperatura ===== -->
        <section *ngIf="activeTab === 'temperature'" class="tab-content">
          <ng-container *ngIf="(temperatureLogsVet?.length ?? 0) > 0; else tempEmpty">
            <app-temperature-tab [temperatureLogs]="temperatureLogsVet"></app-temperature-tab>
          </ng-container>
          <ng-template #tempEmpty>
            <p class="muted">Brak danych w wybranym filtrze.</p>
          </ng-template>
        </section>

        <!-- ===== Cukrzyca ===== -->
        <section *ngIf="activeTab === 'diabetes'" class="tab-content">
          <ng-container *ngIf="(diabetesLogsVet?.length ?? 0) > 0; else diabetesEmpty">
            <app-diabetes-tab [diabetesLogs]="diabetesLogsVet"></app-diabetes-tab>
          </ng-container>
          <ng-template #diabetesEmpty>
            <p class="muted">Brak danych w wybranym filtrze.</p>
          </ng-template>
        </section>

        <!-- ===== Waga ===== -->
        <section *ngIf="activeTab === 'weight'" class="tab-content">
          <ng-container *ngIf="(weightHistoryVet?.length ?? 0) > 0; else weightEmpty">
            <app-weight-tab [weightHistory]="weightHistoryVet"></app-weight-tab>
          </ng-container>
          <ng-template #weightEmpty>
            <p class="muted">Brak danych w wybranym filtrze.</p>
          </ng-template>
        </section>

        <!-- ===== Szczepienia ===== -->
        <section *ngIf="activeTab === 'vaccinations'" class="tab-content">
          <ng-container *ngIf="(vaccinationsVet?.length ?? 0) > 0; else vaccEmpty">
            <app-vaccinations-tab [vaccinations]="vaccinationsVet"></app-vaccinations-tab>
          </ng-container>
          <ng-template #vaccEmpty>
            <p class="muted">Brak danych w wybranym filtrze.</p>
          </ng-template>
        </section>

        <!-- ===== Leki ===== -->
        <section *ngIf="activeTab === 'meds'" class="tab-content">
          <ng-container *ngIf="(medicationsVet?.length ?? 0) > 0; else medsEmpty">
            <app-meds-tab [animalId]="animal?._id" [medications]="medicationsVet"></app-meds-tab>
          </ng-container>
          <ng-template #medsEmpty>
            <p class="muted">Brak danych w wybranym filtrze.</p>
          </ng-template>
        </section>

        <!-- ===== Objawy ===== -->
        <section *ngIf="activeTab === 'symptoms'" class="tab-content">
          <ng-container *ngIf="(symptomsVet?.length ?? 0) > 0; else symptomsEmpty">
            <app-symptoms-tab [symptoms]="symptomsVet"></app-symptoms-tab>
          </ng-container>
          <ng-template #symptomsEmpty>
            <p class="muted">Brak danych w wybranym filtrze.</p>
          </ng-template>
        </section>
      </div>
    </div>

    <div *ngIf="!loading && !animal" class="empty-state">
      Nie znaleziono zwierzaka.
    </div>

  </div>
</div>