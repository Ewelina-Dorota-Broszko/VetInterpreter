<div class="dashboard-menu-container">
  <div class="container clinical-notes">
    <h2>Notatki kliniczne</h2>

    <!-- === Uploader === -->
   <section class="upload-box"
         [class.active]="fileToUpload"
         [class.dragover]="isDragOver"
         (dragover)="onDragOver($event)"
         (dragleave)="onDragLeave($event)"
         (drop)="onDrop($event)">

  <div class="upload-content" (click)="triggerFileInput()">
    <div class="icon">
      <i class="fas fa-cloud-upload-alt"></i>
    </div>

    <p *ngIf="!fileToUpload">Przeciągnij plik tutaj lub kliknij, aby wybrać</p>
    <p *ngIf="fileToUpload">
      <strong>{{ truncateName(fileToUpload.name, 40) }}</strong> — gotowy do wysłania
    </p>

    <input id="fileInput"
           type="file"
           #fileInput
           (change)="onFileChange($event)"
           accept=".png,.jpg,.jpeg,.webp,.pdf,.doc,.docx,image/*,application/pdf"
           hidden />
  </div>

  <div class="note-row">
    <input type="text"
           [(ngModel)]="note"
           placeholder="Dodaj notatkę (opcjonalnie)" />
    <button class="btn send"
            (click)="upload()"
            [disabled]="uploading || !fileToUpload">
      {{ uploading ? 'Wysyłanie...' : 'Wyślij plik' }}
    </button>
  </div>

  <div class="error" *ngIf="error">{{ error }}</div>
</section>


    <!-- === Lista plików === -->
    <div class="files-grid" *ngIf="files.length; else emptyList">
      <div class="file-card" *ngFor="let f of files" [ngClass]="fileTypeClass(f.originalName)">
        <div class="file-icon">
          <img [src]="getFileIcon(f.originalName)" alt="Ikona pliku" />
        </div>

        <div class="file-info">
          <h4 title="{{ f.originalName }}">{{ truncateName(f.originalName, 20) }}</h4>
          <p>{{ f.uploadedAt | date:'yyyy-MM-dd HH:mm' }}</p>
          <p title="{{ f.originalName }}" class="note">{{ f.note || '—' }}</p>

        </div>

        <div class="file-actions">
          <button class="ghost" (click)="open(f)">Otwórz</button>
          <button class="ghost" (click)="delete(f)">Usuń</button>
        </div>
      </div>
    </div>

    <ng-template #emptyList>
      <section class="empty">
        <p>Brak plików — dodaj pierwszy powyżej.</p>
      </section>
    </ng-template>
  </div>
</div>