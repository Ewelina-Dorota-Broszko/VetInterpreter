<div class="dashboard-menu-container">
  <div class="container">

    <div class="bar">
      <div class="left">
        <h2>Weterynarze</h2>
      </div>
      <div class="right small-nav">
        <a routerLink="/admin/owners" class="ghost" routerLinkActive="active">Klienci</a>
      </div>
    </div>

    <div class="filters">
      <input type="text" placeholder="Szukaj (klinika, email, licencja…)" [(ngModel)]="q" (keyup.enter)="onSearch()">
      <button (click)="onSearch()">Szukaj</button>

      <div class="spacer"></div>

      <label>Na stronę:
        <select [(ngModel)]="limit" (change)="onLimitChange()">
          <option *ngFor="let l of limits" [value]="l">{{ l }}</option>
        </select>
      </label>
    </div>

    <div *ngIf="loading" class="muted">Ładowanie…</div>
    <p class="error" *ngIf="!loading && error">{{ error }}</p>

    <ng-container *ngIf="!loading && !error">
      <p class="muted" *ngIf="!rows.length">Brak wyników.</p>

      <table *ngIf="rows.length">
        <thead>
          <tr>
            <th>Klinika</th>
            <th>Nr licencji</th>
            <th>Telefon</th>
            <th>Email</th>
            <th>User ID</th>
            <th>Ostatnie logowanie</th>
            <th class="center">Akcje</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let r of rows; trackBy: trackById">
            <td>{{ r.clinicName || '—' }}</td>
            <td>{{ r.licenseNo || '—' }}</td>
            <td>{{ r.phone || '—' }}</td>
            <td><a [href]="'mailto:'+r.email">{{ r.email }}</a></td>
            <td class="mono">{{ r.userId }}</td>
            <td>{{ r.lastLoginAt ? (r.lastLoginAt | date:'yyyy-MM-dd HH:mm') : '—' }}</td>
            <td class="center">
              <div class="row-actions">
                <button class="ghost" (click)="togglePass(r)">{{ r._editingPass ? 'Anuluj' : 'Zmień hasło' }}</button>
                <button class="danger" (click)="deleteVet(r)" [disabled]="r._busy">Usuń</button>
              </div>

              <div class="pass-editor" *ngIf="r._editingPass">
                <input type="password" placeholder="Nowe hasło (min 6)" [(ngModel)]="r._newPass">
                <button (click)="resetPass(r)" [disabled]="r._busy">Zapisz</button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <div class="paginator" *ngIf="total > limit">
        <button (click)="prev()" [disabled]="page===1">←</button>
        <span>{{ rangeText() }}</span>
        <button (click)="next()" [disabled]="page*limit>=total">→</button>
      </div>
    </ng-container>

  </div>
</div>
