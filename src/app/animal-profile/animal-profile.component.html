<div class="dashboard-menu-container" *ngIf="animal">
  <div class="container">
    <p *ngIf="animal.vetId; else noVet">
      Przypisany wet: <a [routerLink]="['/vet', animal.vetId]">zobacz profil</a>
      <button type="button" class="danger" (click)="unassignVet()">Odepnij</button>
    </p>
    <ng-template #noVet>
      <p>Brak przypisanego weta.
        <button type="button" (click)="goAssignVet()">Przypisz weterynarza</button>
      </p>
    </ng-template>

    <div class="actions">
      <button type="button" (click)="addNewDocument()">Dodaj nowy dokument</button>
      <button type="button" class="danger" (click)="onDeleteAnimal()" [disabled]="deleting">
        {{ deleting ? 'Usuwanie…' : 'Usuń zwierzaka' }}
      </button>
    </div>

    <!-- ===== Historia wizyt ===== -->
    <section class="visit-history" *ngIf="animal.visitHistory?.length">
      <h3>Historia wizyt</h3>

      <div *ngFor="let visit of animal.visitHistory; trackBy: trackByIndex" class="visit-card">
        <div class="visit-summary" (click)="toggleDetails(visit)">
          <strong>{{ visit.visitDate }}</strong>
          – {{ visit.clinicName }} ({{ visit.vetName }})
          <span *ngIf="visit.nextVisitDate"> | Następna: {{ visit.nextVisitDate }}</span>
        </div>

        <div class="visit-details" *ngIf="visit.expanded">
          <p><strong>Objawy:</strong> {{ visit.symptoms || '—' }}</p>
          <p><strong>Leczenie:</strong> {{ visit.treatments || '—' }}</p>

          <div *ngIf="visit.medications?.length">
            <strong>Leki:</strong>
            <ul>
              <li *ngFor="let med of visit.medications">
                {{ med.name }} – {{ med.dosage }} – {{ med.frequency }}
              </li>
            </ul>
          </div>

          <p><strong>Notatki:</strong> {{ visit.notes || '—' }}</p>
        </div>
      </div>
    </section>

    <!-- ===== Nagłówek profilu ===== -->
    <div class="profile-wrapper">
      <header class="header">
        <div class="info">
          <h1>{{ animal.name }}</h1>
          <p *ngIf="animal.ownerName">Właściciel: <strong>{{ animal.ownerName }}</strong></p>
          <p>
            Gatunek: <strong>{{ animal.species }}</strong>
            <span *ngIf="animal.breed"> | Rasa: <strong>{{ animal.breed }}</strong></span>
          </p>
          <p>
            Płeć: <strong>{{ animal.sex }}</strong>
            <span *ngIf="animal.weightKg"> | Waga: <strong>{{ animal.weightKg }} kg</strong></span>
          </p>
          <p *ngIf="getAgeYears() !== null">Wiek: <strong>{{ getAgeYears() }} lat</strong></p>
        </div>

        <div class="actions">
          <button type="button" (click)="addNewDocument()">Dodaj nowy dokument</button>
        </div>
      </header>

      <!-- ===== Zakładki ===== -->
      <nav class="tabs">
        <button [class.active]="activeTab === 'overview'" (click)="setTab('overview')">Podsumowanie</button>
        <button [class.active]="activeTab === 'blood'" (click)="setTab('blood')">Krew</button>
        <button [class.active]="activeTab === 'urine'" (click)="setTab('urine')">Mocz</button>
        <button [class.active]="activeTab === 'stool'" (click)="setTab('stool')">Kał</button>
        <button [class.active]="activeTab === 'temperature'" (click)="setTab('temperature')">Temperatura</button>
        <button [class.active]="activeTab === 'diabetes'" (click)="setTab('diabetes')">Cukrzyca</button>
        <button [class.active]="activeTab === 'weight'" (click)="setTab('weight')">Waga & BCS</button>
        <button [class.active]="activeTab === 'vaccinations'" (click)="setTab('vaccinations')">Szczepienia</button>
        <button [class.active]="activeTab === 'meds'" (click)="setTab('meds')">Leki</button>
        <button [class.active]="activeTab === 'symptoms'" (click)="setTab('symptoms')">Objawy</button>
      </nav>

      <!-- ===== Podsumowanie ===== -->
      <!-- <section *ngIf="activeTab === 'overview'" class="tab-content">
        <h2>Podsumowanie</h2>

        <div class="cards">
          <div class="card" *ngIf="latest(animal.bloodTests) as lastBlood">
            <h3>Ostatnie badanie krwi</h3>
            <p>Data: {{ lastBlood.date }}</p>
            <p>HGB: {{ lastBlood.hemoglobin }} g/dL</p>
            <p>WBC: {{ lastBlood.wbc }} 10⁹/L</p>
            <p>Glukoza: {{ lastBlood.glucose }} mg/dL</p>
          </div>

          <div class="card" *ngIf="latest(animal.urineTests) as lastUrine">
            <h3>Ostatnie badanie moczu</h3>
            <p>Data: {{ lastUrine.date }}</p>
            <p>SG: {{ lastUrine.specificGravity }}</p>
            <p>pH: {{ lastUrine.pH }}</p>
            <p>Białko: {{ lastUrine.protein }}</p>
          </div>

          <div class="card" *ngIf="latest(animal.temperatureLogs) as lastTemp">
            <h3>Ostatni pomiar temperatury</h3>
            <p>Data: {{ lastTemp.date }} {{ lastTemp.time }}</p>
            <p>Temp: {{ lastTemp.temperature }} °C</p>
          </div>

          <div class="card" *ngIf="latest(animal.diabetesLogs) as lastDiab">
            <h3>Ostatni zapis cukrzycy</h3>
            <p>Data: {{ lastDiab.date }} {{ lastDiab.time }}</p>
            <p>Glukoza: {{ lastDiab.glucose }} mg/dL</p>
            <p>Typ: {{ lastDiab.measurementType }}</p>
            <p *ngIf="lastDiab.insulinType">Insulina: {{ lastDiab.insulinType }} ({{ lastDiab.insulinDose || 0 }} j.)</p>
          </div>
        </div>
      </section> -->

      <!-- ===== Badania krwi ===== -->
      <section *ngIf="activeTab === 'blood'" class="tab-content">
        <app-blood-tab [active]="activeTab === 'blood'" [bloodTests]="animal?.bloodTests || []"
          [referenceRanges]="referenceRanges">
        </app-blood-tab>
      </section>


      <!-- ===== Badania moczu ===== -->
      <section *ngIf="activeTab === 'urine'" class="tab-content">
        <app-urine-tab [urineTests]="animal?.urineTests || []"></app-urine-tab>
      </section>


      <!-- ===== Badania kału ===== -->
      <section *ngIf="activeTab === 'stool'" class="tab-content">
        <app-stool-tab [stoolTests]="animal?.stoolTests || []"></app-stool-tab>
      </section>


      <!-- ===== Pomiary temperatury ===== -->
      <section *ngIf="activeTab === 'temperature'" class="tab-content">
        <app-temperature-tab [temperatureLogs]="animal?.temperatureLogs || []"></app-temperature-tab>
      </section>


      <!-- ===== Cukrzyca ===== -->
      <section *ngIf="activeTab === 'diabetes'" class="tab-content">
        <app-diabetes-tab [diabetesLogs]="animal?.diabetesLogs || []"></app-diabetes-tab>
      </section>


      <!-- ===== Waga & BCS ===== -->
      <section *ngIf="activeTab === 'weight'" class="tab-content">
        <app-weight-tab [weightHistory]="animal?.weightHistory || []"></app-weight-tab>
      </section>


      <!-- ===== Szczepienia ===== -->

      <section *ngIf="activeTab === 'vaccinations'" class="tab-content">
        <app-vaccinations-tab [vaccinations]="animal?.vaccinations || []">
        </app-vaccinations-tab>
      </section>

      <!-- ===== Leki ===== -->
      <section *ngIf="activeTab === 'meds'" class="tab-content">
        <app-meds-tab [animalId]="animal?._id" [medications]="animal?.medications || []"></app-meds-tab>
      </section>


      <!-- ===== Objawy ===== -->
      <section *ngIf="activeTab === 'symptoms'" class="tab-content">
        <app-symptoms-tab [symptoms]="animal?.symptoms || []"></app-symptoms-tab>
      </section>


    </div>

    <!-- (opcjonalnie) kalendarz ogólny aplikacji -->
    <!-- <app-calendar></app-calendar> -->
  </div>
</div>

<!-- Gdy brak danych zwierzaka -->
<div *ngIf="!animal" class="empty-state">
  Ładuję dane profilu…
</div>